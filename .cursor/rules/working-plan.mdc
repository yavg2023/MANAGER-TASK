---
alwaysApply: false
---
# Working Plan Generation Rule

## Objetivo
Esta rule define c√≥mo Cursor debe generar planes de trabajo estructurados para implementar features o realizar desarrollos espec√≠ficos en la aplicaci√≥n de gesti√≥n de tareas.

## Directiva de Uso
**Aplicar esta rule cuando:**
- El usuario solicite crear un plan de trabajo para una feature nueva
- El usuario solicite un plan para implementar mejoras espec√≠ficas
- El usuario solicite organizar tareas de desarrollo

## Estructura de Planes de Trabajo

### 1. Ubicaci√≥n y Nomenclatura
- **Ubicaci√≥n**: Todos los planes se guardan en `.specs/`
- **Formato de nombre**: `NNNN-nombre-descriptivo.md`
  - `NNNN`: N√∫mero consecutivo de 4 d√≠gitos (0001, 0002, 0003, etc.)
  - `nombre-descriptivo`: Nombre en kebab-case que describe la feature o desarrollo
  - Ejemplo: `0001-manejo-errores-validaciones.md`

### 2. Estructura del Documento

Cada plan debe seguir esta estructura m√≠nima:

```markdown
# [NNNN] Nombre Descriptivo de la Feature

## üìã Resumen Ejecutivo
Breve descripci√≥n (2-3 p√°rrafos) de qu√© se va a implementar y por qu√©.

## üéØ Objetivos
Lista numerada de objetivos claros y medibles:
1. Objetivo 1
2. Objetivo 2
3. Objetivo 3

## üì¶ Estructura de Implementaci√≥n

### Fase 1: [Nombre de la Fase]
**Orden l√≥gico**: Esta fase debe ejecutarse primero/despu√©s de X porque...

**Archivos a crear/modificar**:
- `ruta/archivo.dart` - Descripci√≥n breve del cambio
- `ruta/archivo2.dart` - Descripci√≥n breve del cambio

**Pasos**:
1. Paso granular espec√≠fico
2. Otro paso granular espec√≠fico
3. Siguiente paso...

**Criterios de aceptaci√≥n**:
- [ ] Criterio 1
- [ ] Criterio 2

### Fase 2: [Nombre de la Fase]
[Estructura similar...]

## ‚úÖ Checklist de Implementaci√≥n

### Fase 1: [Nombre]
- [ ] Paso 1 completado
- [ ] Paso 2 completado

### Fase 2: [Nombre]
- [ ] Paso 1 completado

## üìù Notas de Implementaci√≥n
Espacio para notas durante la implementaci√≥n.

## üöÄ Pr√≥ximos Pasos
Opcional: qu√© podr√≠a venir despu√©s de esta implementaci√≥n.
```

### 3. Caracter√≠sticas M√≠nimas

#### 3.1. Organizaci√≥n por Fases
- **Cada fase** debe ser un elemento espec√≠fico de la estructura del proyecto (modelos, servicios, providers, screens, widgets, etc.)
- **Orden l√≥gico**: Las fases deben tener un orden de ejecuci√≥n claro (por ejemplo: modelos ‚Üí servicios ‚Üí providers ‚Üí UI)
- **Dependencias**: Si una fase depende de otra, debe indicarse claramente

#### 3.2. Pasos Granulares
- Cada fase debe tener pasos espec√≠ficos y accionables
- Los pasos deben ser incrementales (no hacer todo en un solo paso)
- Cada paso debe ser verificable

#### 3.3. Fragmentos Explicativos
- **NO incluir c√≥digo fuente completo** en el plan
- **S√ç incluir fragmentos** que auto-explican los cambios necesarios
- Los fragmentos deben ser suficientes para entender el cambio sin ser exhaustivos

#### 3.4. Estructura Simple
- Evitar complejidad innecesaria
- El plan debe ser f√°cil de entender por el usuario
- Priorizar claridad sobre exhaustividad

### 4. Flujo de Trabajo

#### 4.1. Generaci√≥n del Plan
Cuando el usuario solicite un plan:
1. Identificar el siguiente n√∫mero consecutivo (verificar `.specs/` para el √∫ltimo n√∫mero usado)
2. Generar el plan siguiendo la estructura definida
3. Guardar el archivo en `.specs/` con el nombre correcto
4. Presentar el plan al usuario para revisi√≥n

#### 4.2. Implementaci√≥n por Fases
Durante la implementaci√≥n:
1. **Completar una fase completa** antes de continuar
2. **Detener autom√°ticamente** despu√©s de completar cada fase
3. **Solicitar al usuario**:
   - Realizar revisiones/verificaciones pertinentes
   - Aprobar la fase completada
4. **Actualizar el progreso** en el plan (marcar checkboxes completados)
5. **Preguntar al usuario** si desea continuar con la siguiente fase

#### 4.3. Actualizaci√≥n del Plan
- Marcar como completados los pasos de cada fase
- Agregar notas en "Notas de Implementaci√≥n" si es necesario
- Mantener el documento actualizado durante toda la implementaci√≥n

### 5. Referencia a Rules de Cursor
- Los planes deben considerar las mejores pr√°cticas definidas en `feature-structure.mdc`
- Los planes deben respetar el alcance funcional definido en `app-scope.mdc`
- Cuando sea relevante, hacer referencia a pr√°cticas espec√≠ficas del feature-structure
- Identificar claramente el m√≥dulo al que pertenece cada feature (security, tasks, backoffice)
- Asegurar consistencia con el marco de implementaci√≥n establecido

### 5.1. Consideraciones Multiplataforma
- **Siempre considerar soporte multiplataforma**: La aplicaci√≥n soporta Web (SharedPreferences) y Mobile/Desktop (SQLite)
- **Consistencia entre plataformas**: Las funcionalidades deben implementarse en ambas plataformas con comportamiento consistente
- **Mencionar en planes**: Cuando una feature afecta persistencia, indicar claramente c√≥mo se implementa en cada plataforma
- **Ejemplos espec√≠ficos**:
  - Migraciones de BD: Solo aplican a SQLite (mobile/desktop), mencionar que web no requiere migraciones autom√°ticas
  - Cambios en modelo: Deben reflejarse en ambos servicios (IO y Web)
  - Filtrado/Ordenamiento: Implementar en SQL con WHERE/ORDER BY (SQLite) y en memoria (Web)
- **Ver referencia**: Consultar `REPORTE-PERSISTENCIA-MULTIPLATAFORMA.md` para detalles sobre aislamiento por usuario y estrategias multiplataforma

### 6. Ejemplo de Plan M√≠nimo

```markdown
# [0001] Agregar Autenticaci√≥n

## üìã Resumen Ejecutivo
Implementar un sistema b√°sico de autenticaci√≥n para proteger el acceso a las tareas.

## üéØ Objetivos
1. Crear modelo de usuario
2. Implementar servicio de autenticaci√≥n
3. Agregar pantalla de login funcional

## üì¶ Estructura de Implementaci√≥n

### Fase 1: Modelo de Usuario
**Orden l√≥gico**: Primero porque otros componentes dependen de √©l.

**Archivos a crear**:
- `lib/models/security/user.dart` - Modelo de usuario con email y password

**Pasos**:
1. Crear clase User con campos email y password
2. Agregar m√©todo toMap/fromMap
3. Verificar que compile sin errores

**Criterios de aceptaci√≥n**:
- [ ] Modelo User creado
- [ ] Serializaci√≥n implementada
- [ ] Sin errores de linter

### Fase 2: Servicio de Autenticaci√≥n
**Orden l√≥gico**: Despu√©s del modelo, antes del provider.

**Archivos a crear**:
- `lib/services/security/auth_service.dart` - L√≥gica de autenticaci√≥n

**Pasos**:
1. Crear clase AuthService
2. Implementar m√©todo login()
3. Implementar m√©todo logout()

[Contin√∫a...]
```

## Recordatorios Importantes
- **Simple y claro**: No sobre-ingenier√≠a en los planes
- **Incremental**: Dividir en fases peque√±as y manejables
- **Verificable**: Cada paso debe poder ser verificado
- **Pausable**: Detener despu√©s de cada fase para revisi√≥n
- **Actualizable**: Mantener el plan actualizado durante la implementaci√≥n
